{
  "hash": "8a1ce88b8e609232f54bef81c9913898",
  "result": {
    "markdown": "---\ntitle: \"Challenge6_Solution\"\nauthor: \"Zhongyue Lin\"\ndescription: \"Visualizing Time and Relationships\"\ndate: \"6/16/2023\"\nformat:\n  html:\n    df-print: paged\n    toc: true\n    code-fold: true\n    code-copy: true\n    code-tools: true\ncategories:\n  - challenge_6\n  - hotel_bookings\n  \n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(scales)\n\nknitr::opts_chunk$set(echo = TRUE, warning=FALSE, message=FALSE)\n```\n:::\n\n\n## Challenge Overview\n\nToday's challenge is to:\n\n1)  read in a data set, and describe the data set using both words and any supporting information (e.g., tables, etc)\n2)  tidy data (as needed, including sanity checks)\n3)  mutate variables as needed (including sanity checks)\n4)  create at least one graph including time (evolution)\n   - try to make them \"publication\" ready (optional)\n   - Explain why you choose the specific graph type\n5)  Create at least one graph depicting part-whole or flow relationships\n   - try to make them \"publication\" ready (optional)\n   - Explain why you choose the specific graph type\n\n## Read in data\n\nRead in one (or more) of the following datasets, using the correct R package and command.\n\n-   hotel_bookings.csv⭐⭐⭐⭐\n\nIn challenge 6, I chose hotel_bookings.csv as the original dataset. This dataset is the one I used in challenge 2&4.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata <- readr::read_csv(\"_data/hotel_bookings.csv\")\nhead(data)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"hotel\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"is_canceled\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"lead_time\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"arrival_date_year\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"arrival_date_month\"],\"name\":[5],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"arrival_date_week_number\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"arrival_date_day_of_month\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"stays_in_weekend_nights\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"stays_in_week_nights\"],\"name\":[9],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"adults\"],\"name\":[10],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"children\"],\"name\":[11],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"babies\"],\"name\":[12],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"meal\"],\"name\":[13],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"country\"],\"name\":[14],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"market_segment\"],\"name\":[15],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"distribution_channel\"],\"name\":[16],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"is_repeated_guest\"],\"name\":[17],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"previous_cancellations\"],\"name\":[18],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"previous_bookings_not_canceled\"],\"name\":[19],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"reserved_room_type\"],\"name\":[20],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"assigned_room_type\"],\"name\":[21],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"booking_changes\"],\"name\":[22],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"deposit_type\"],\"name\":[23],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"agent\"],\"name\":[24],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"company\"],\"name\":[25],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"days_in_waiting_list\"],\"name\":[26],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"customer_type\"],\"name\":[27],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"adr\"],\"name\":[28],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"required_car_parking_spaces\"],\"name\":[29],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"total_of_special_requests\"],\"name\":[30],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"reservation_status\"],\"name\":[31],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"reservation_status_date\"],\"name\":[32],\"type\":[\"date\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"Resort Hotel\",\"2\":\"0\",\"3\":\"342\",\"4\":\"2015\",\"5\":\"July\",\"6\":\"27\",\"7\":\"1\",\"8\":\"0\",\"9\":\"0\",\"10\":\"2\",\"11\":\"0\",\"12\":\"0\",\"13\":\"BB\",\"14\":\"PRT\",\"15\":\"Direct\",\"16\":\"Direct\",\"17\":\"0\",\"18\":\"0\",\"19\":\"0\",\"20\":\"C\",\"21\":\"C\",\"22\":\"3\",\"23\":\"No Deposit\",\"24\":\"NULL\",\"25\":\"NULL\",\"26\":\"0\",\"27\":\"Transient\",\"28\":\"0\",\"29\":\"0\",\"30\":\"0\",\"31\":\"Check-Out\",\"32\":\"2015-07-01\"},{\"1\":\"Resort Hotel\",\"2\":\"0\",\"3\":\"737\",\"4\":\"2015\",\"5\":\"July\",\"6\":\"27\",\"7\":\"1\",\"8\":\"0\",\"9\":\"0\",\"10\":\"2\",\"11\":\"0\",\"12\":\"0\",\"13\":\"BB\",\"14\":\"PRT\",\"15\":\"Direct\",\"16\":\"Direct\",\"17\":\"0\",\"18\":\"0\",\"19\":\"0\",\"20\":\"C\",\"21\":\"C\",\"22\":\"4\",\"23\":\"No Deposit\",\"24\":\"NULL\",\"25\":\"NULL\",\"26\":\"0\",\"27\":\"Transient\",\"28\":\"0\",\"29\":\"0\",\"30\":\"0\",\"31\":\"Check-Out\",\"32\":\"2015-07-01\"},{\"1\":\"Resort Hotel\",\"2\":\"0\",\"3\":\"7\",\"4\":\"2015\",\"5\":\"July\",\"6\":\"27\",\"7\":\"1\",\"8\":\"0\",\"9\":\"1\",\"10\":\"1\",\"11\":\"0\",\"12\":\"0\",\"13\":\"BB\",\"14\":\"GBR\",\"15\":\"Direct\",\"16\":\"Direct\",\"17\":\"0\",\"18\":\"0\",\"19\":\"0\",\"20\":\"A\",\"21\":\"C\",\"22\":\"0\",\"23\":\"No Deposit\",\"24\":\"NULL\",\"25\":\"NULL\",\"26\":\"0\",\"27\":\"Transient\",\"28\":\"75\",\"29\":\"0\",\"30\":\"0\",\"31\":\"Check-Out\",\"32\":\"2015-07-02\"},{\"1\":\"Resort Hotel\",\"2\":\"0\",\"3\":\"13\",\"4\":\"2015\",\"5\":\"July\",\"6\":\"27\",\"7\":\"1\",\"8\":\"0\",\"9\":\"1\",\"10\":\"1\",\"11\":\"0\",\"12\":\"0\",\"13\":\"BB\",\"14\":\"GBR\",\"15\":\"Corporate\",\"16\":\"Corporate\",\"17\":\"0\",\"18\":\"0\",\"19\":\"0\",\"20\":\"A\",\"21\":\"A\",\"22\":\"0\",\"23\":\"No Deposit\",\"24\":\"304\",\"25\":\"NULL\",\"26\":\"0\",\"27\":\"Transient\",\"28\":\"75\",\"29\":\"0\",\"30\":\"0\",\"31\":\"Check-Out\",\"32\":\"2015-07-02\"},{\"1\":\"Resort Hotel\",\"2\":\"0\",\"3\":\"14\",\"4\":\"2015\",\"5\":\"July\",\"6\":\"27\",\"7\":\"1\",\"8\":\"0\",\"9\":\"2\",\"10\":\"2\",\"11\":\"0\",\"12\":\"0\",\"13\":\"BB\",\"14\":\"GBR\",\"15\":\"Online TA\",\"16\":\"TA/TO\",\"17\":\"0\",\"18\":\"0\",\"19\":\"0\",\"20\":\"A\",\"21\":\"A\",\"22\":\"0\",\"23\":\"No Deposit\",\"24\":\"240\",\"25\":\"NULL\",\"26\":\"0\",\"27\":\"Transient\",\"28\":\"98\",\"29\":\"0\",\"30\":\"1\",\"31\":\"Check-Out\",\"32\":\"2015-07-03\"},{\"1\":\"Resort Hotel\",\"2\":\"0\",\"3\":\"14\",\"4\":\"2015\",\"5\":\"July\",\"6\":\"27\",\"7\":\"1\",\"8\":\"0\",\"9\":\"2\",\"10\":\"2\",\"11\":\"0\",\"12\":\"0\",\"13\":\"BB\",\"14\":\"GBR\",\"15\":\"Online TA\",\"16\":\"TA/TO\",\"17\":\"0\",\"18\":\"0\",\"19\":\"0\",\"20\":\"A\",\"21\":\"A\",\"22\":\"0\",\"23\":\"No Deposit\",\"24\":\"240\",\"25\":\"NULL\",\"26\":\"0\",\"27\":\"Transient\",\"28\":\"98\",\"29\":\"0\",\"30\":\"1\",\"31\":\"Check-Out\",\"32\":\"2015-07-03\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n### Briefly describe the data\n\nAccording to the EDA of this dataset in Challenge 2, it is understood that this dataset is about the data records of two hotels, **Resort hotel** and **City hotel**. The dataset contains customer data, business data and other related data. The data structure of this dataset is **119,390** rows **32** columns.\n\n## Tidy Data (as needed)\nThe code in the 'Tidy Data' section is an optimized version based on the code from Challenge 4. This optimization is in line with a more tidyverse-centric method, making the data cleaning process more streamlined and consistent with the principles of 'tidy data'.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Checking for missing values in each column\ndata %>%\n  summarize_all(~sum(is.na(.)))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"hotel\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"is_canceled\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"lead_time\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"arrival_date_year\"],\"name\":[4],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"arrival_date_month\"],\"name\":[5],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"arrival_date_week_number\"],\"name\":[6],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"arrival_date_day_of_month\"],\"name\":[7],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"stays_in_weekend_nights\"],\"name\":[8],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"stays_in_week_nights\"],\"name\":[9],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"adults\"],\"name\":[10],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"children\"],\"name\":[11],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"babies\"],\"name\":[12],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"meal\"],\"name\":[13],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"country\"],\"name\":[14],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"market_segment\"],\"name\":[15],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"distribution_channel\"],\"name\":[16],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"is_repeated_guest\"],\"name\":[17],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"previous_cancellations\"],\"name\":[18],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"previous_bookings_not_canceled\"],\"name\":[19],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"reserved_room_type\"],\"name\":[20],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"assigned_room_type\"],\"name\":[21],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"booking_changes\"],\"name\":[22],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"deposit_type\"],\"name\":[23],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"agent\"],\"name\":[24],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"company\"],\"name\":[25],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"days_in_waiting_list\"],\"name\":[26],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"customer_type\"],\"name\":[27],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"adr\"],\"name\":[28],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"required_car_parking_spaces\"],\"name\":[29],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"total_of_special_requests\"],\"name\":[30],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"reservation_status\"],\"name\":[31],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"reservation_status_date\"],\"name\":[32],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"0\",\"2\":\"0\",\"3\":\"0\",\"4\":\"0\",\"5\":\"0\",\"6\":\"0\",\"7\":\"0\",\"8\":\"0\",\"9\":\"0\",\"10\":\"0\",\"11\":\"4\",\"12\":\"0\",\"13\":\"0\",\"14\":\"0\",\"15\":\"0\",\"16\":\"0\",\"17\":\"0\",\"18\":\"0\",\"19\":\"0\",\"20\":\"0\",\"21\":\"0\",\"22\":\"0\",\"23\":\"0\",\"24\":\"0\",\"25\":\"0\",\"26\":\"0\",\"27\":\"0\",\"28\":\"0\",\"29\":\"0\",\"30\":\"0\",\"31\":\"0\",\"32\":\"0\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\n# Identifying rows with missing data\nmissing_rows_index <- which(apply(data, 1, anyNA))\n\n# Print out rows with missing values\nmissing_rows <- data[missing_rows_index, ]\nprint(missing_rows)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 32\n  hotel   is_ca…¹ lead_…² arriv…³ arriv…⁴ arriv…⁵ arriv…⁶ stays…⁷ stays…⁸ adults\n  <chr>     <dbl>   <dbl>   <dbl> <chr>     <dbl>   <dbl>   <dbl>   <dbl>  <dbl>\n1 City H…       1       2    2015 August       32       3       1       0      2\n2 City H…       1       1    2015 August       32       5       0       2      2\n3 City H…       1       1    2015 August       32       5       0       2      3\n4 City H…       1       8    2015 August       33      13       2       5      2\n# … with 22 more variables: children <dbl>, babies <dbl>, meal <chr>,\n#   country <chr>, market_segment <chr>, distribution_channel <chr>,\n#   is_repeated_guest <dbl>, previous_cancellations <dbl>,\n#   previous_bookings_not_canceled <dbl>, reserved_room_type <chr>,\n#   assigned_room_type <chr>, booking_changes <dbl>, deposit_type <chr>,\n#   agent <chr>, company <chr>, days_in_waiting_list <dbl>,\n#   customer_type <chr>, adr <dbl>, required_car_parking_spaces <dbl>, …\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Replace missing values in the 'children' column with 0 using replace_na()\ndata <- data %>%\n  replace_na(list(children = 0))\n\n# Check again for missing values to confirm replacement\ndata %>%\n  summarize_all(~sum(is.na(.)))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"hotel\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"is_canceled\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"lead_time\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"arrival_date_year\"],\"name\":[4],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"arrival_date_month\"],\"name\":[5],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"arrival_date_week_number\"],\"name\":[6],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"arrival_date_day_of_month\"],\"name\":[7],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"stays_in_weekend_nights\"],\"name\":[8],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"stays_in_week_nights\"],\"name\":[9],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"adults\"],\"name\":[10],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"children\"],\"name\":[11],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"babies\"],\"name\":[12],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"meal\"],\"name\":[13],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"country\"],\"name\":[14],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"market_segment\"],\"name\":[15],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"distribution_channel\"],\"name\":[16],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"is_repeated_guest\"],\"name\":[17],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"previous_cancellations\"],\"name\":[18],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"previous_bookings_not_canceled\"],\"name\":[19],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"reserved_room_type\"],\"name\":[20],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"assigned_room_type\"],\"name\":[21],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"booking_changes\"],\"name\":[22],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"deposit_type\"],\"name\":[23],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"agent\"],\"name\":[24],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"company\"],\"name\":[25],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"days_in_waiting_list\"],\"name\":[26],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"customer_type\"],\"name\":[27],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"adr\"],\"name\":[28],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"required_car_parking_spaces\"],\"name\":[29],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"total_of_special_requests\"],\"name\":[30],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"reservation_status\"],\"name\":[31],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"reservation_status_date\"],\"name\":[32],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"0\",\"2\":\"0\",\"3\":\"0\",\"4\":\"0\",\"5\":\"0\",\"6\":\"0\",\"7\":\"0\",\"8\":\"0\",\"9\":\"0\",\"10\":\"0\",\"11\":\"0\",\"12\":\"0\",\"13\":\"0\",\"14\":\"0\",\"15\":\"0\",\"16\":\"0\",\"17\":\"0\",\"18\":\"0\",\"19\":\"0\",\"20\":\"0\",\"21\":\"0\",\"22\":\"0\",\"23\":\"0\",\"24\":\"0\",\"25\":\"0\",\"26\":\"0\",\"27\":\"0\",\"28\":\"0\",\"29\":\"0\",\"30\":\"0\",\"31\":\"0\",\"32\":\"0\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\nIn this block of code, I dealt with missing values within the dataset. I specifically targeted the 'children' column, using the `replace_na()` function to replace all missing values (NA) with 0. This is under the assumption that if the data doesn't explicitly specify the number of children, it's likely because no children were involved in the booking.\n\nAfter the replacement operation, I conducted another check for missing values to ensure that there were no more missing values in the 'children' column. To achieve this, I utilized the `summarize_all()` function to count the number of missing values in each column of the dataset.\n\nBased on the feedback from Challenge 4, I've made some modifications in this code to enhance the way the data is processed, thus improving data cleaning and handling of missing values.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Combine year, month, and day of month into a single date column\ndata <- data %>%\n  mutate(arrival_date = as.Date(paste(arrival_date_year, arrival_date_month, arrival_date_day_of_month, sep = \"-\"), format = \"%Y-%B-%d\")) %>%\n  select(-arrival_date_year, -arrival_date_month, -arrival_date_week_number, -arrival_date_day_of_month)\n\n# Convert 'is_canceled' and 'is_repeated_guest' to logical (boolean) values using case_when()\ndata <- data %>%\n  mutate(is_canceled = case_when(is_canceled == 1 ~ TRUE,\n                                 is_canceled == 0 ~ FALSE),\n         is_repeated_guest = case_when(is_repeated_guest == 1 ~ TRUE,\n                                       is_repeated_guest == 0 ~ FALSE))\n\n# Print unique values of categorical variables\nunique_values <- data %>%\n  select(hotel, meal, country, market_segment, distribution_channel, reserved_room_type, assigned_room_type, deposit_type, customer_type, reservation_status) %>%\n  sapply(unique)\nprint(unique_values)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n$hotel\n[1] \"Resort Hotel\" \"City Hotel\"  \n\n$meal\n[1] \"BB\"        \"FB\"        \"HB\"        \"SC\"        \"Undefined\"\n\n$country\n  [1] \"PRT\"  \"GBR\"  \"USA\"  \"ESP\"  \"IRL\"  \"FRA\"  \"NULL\" \"ROU\"  \"NOR\"  \"OMN\" \n [11] \"ARG\"  \"POL\"  \"DEU\"  \"BEL\"  \"CHE\"  \"CN\"   \"GRC\"  \"ITA\"  \"NLD\"  \"DNK\" \n [21] \"RUS\"  \"SWE\"  \"AUS\"  \"EST\"  \"CZE\"  \"BRA\"  \"FIN\"  \"MOZ\"  \"BWA\"  \"LUX\" \n [31] \"SVN\"  \"ALB\"  \"IND\"  \"CHN\"  \"MEX\"  \"MAR\"  \"UKR\"  \"SMR\"  \"LVA\"  \"PRI\" \n [41] \"SRB\"  \"CHL\"  \"AUT\"  \"BLR\"  \"LTU\"  \"TUR\"  \"ZAF\"  \"AGO\"  \"ISR\"  \"CYM\" \n [51] \"ZMB\"  \"CPV\"  \"ZWE\"  \"DZA\"  \"KOR\"  \"CRI\"  \"HUN\"  \"ARE\"  \"TUN\"  \"JAM\" \n [61] \"HRV\"  \"HKG\"  \"IRN\"  \"GEO\"  \"AND\"  \"GIB\"  \"URY\"  \"JEY\"  \"CAF\"  \"CYP\" \n [71] \"COL\"  \"GGY\"  \"KWT\"  \"NGA\"  \"MDV\"  \"VEN\"  \"SVK\"  \"FJI\"  \"KAZ\"  \"PAK\" \n [81] \"IDN\"  \"LBN\"  \"PHL\"  \"SEN\"  \"SYC\"  \"AZE\"  \"BHR\"  \"NZL\"  \"THA\"  \"DOM\" \n [91] \"MKD\"  \"MYS\"  \"ARM\"  \"JPN\"  \"LKA\"  \"CUB\"  \"CMR\"  \"BIH\"  \"MUS\"  \"COM\" \n[101] \"SUR\"  \"UGA\"  \"BGR\"  \"CIV\"  \"JOR\"  \"SYR\"  \"SGP\"  \"BDI\"  \"SAU\"  \"VNM\" \n[111] \"PLW\"  \"QAT\"  \"EGY\"  \"PER\"  \"MLT\"  \"MWI\"  \"ECU\"  \"MDG\"  \"ISL\"  \"UZB\" \n[121] \"NPL\"  \"BHS\"  \"MAC\"  \"TGO\"  \"TWN\"  \"DJI\"  \"STP\"  \"KNA\"  \"ETH\"  \"IRQ\" \n[131] \"HND\"  \"RWA\"  \"KHM\"  \"MCO\"  \"BGD\"  \"IMN\"  \"TJK\"  \"NIC\"  \"BEN\"  \"VGB\" \n[141] \"TZA\"  \"GAB\"  \"GHA\"  \"TMP\"  \"GLP\"  \"KEN\"  \"LIE\"  \"GNB\"  \"MNE\"  \"UMI\" \n[151] \"MYT\"  \"FRO\"  \"MMR\"  \"PAN\"  \"BFA\"  \"LBY\"  \"MLI\"  \"NAM\"  \"BOL\"  \"PRY\" \n[161] \"BRB\"  \"ABW\"  \"AIA\"  \"SLV\"  \"DMA\"  \"PYF\"  \"GUY\"  \"LCA\"  \"ATA\"  \"GTM\" \n[171] \"ASM\"  \"MRT\"  \"NCL\"  \"KIR\"  \"SDN\"  \"ATF\"  \"SLE\"  \"LAO\" \n\n$market_segment\n[1] \"Direct\"        \"Corporate\"     \"Online TA\"     \"Offline TA/TO\"\n[5] \"Complementary\" \"Groups\"        \"Undefined\"     \"Aviation\"     \n\n$distribution_channel\n[1] \"Direct\"    \"Corporate\" \"TA/TO\"     \"Undefined\" \"GDS\"      \n\n$reserved_room_type\n [1] \"C\" \"A\" \"D\" \"E\" \"G\" \"F\" \"H\" \"L\" \"P\" \"B\"\n\n$assigned_room_type\n [1] \"C\" \"A\" \"D\" \"E\" \"G\" \"F\" \"I\" \"B\" \"H\" \"P\" \"L\" \"K\"\n\n$deposit_type\n[1] \"No Deposit\" \"Refundable\" \"Non Refund\"\n\n$customer_type\n[1] \"Transient\"       \"Contract\"        \"Transient-Party\" \"Group\"          \n\n$reservation_status\n[1] \"Check-Out\" \"Canceled\"  \"No-Show\"  \n```\n:::\n\n```{.r .cell-code}\n# Convert categorical variables into factors\ndata <- data %>%\n  mutate_at(vars(hotel, meal, country, market_segment, distribution_channel, reserved_room_type, assigned_room_type, deposit_type, customer_type, reservation_status), \n            factor)\n\n# Print the first few rows of the data to verify transformations\nhead(data)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"hotel\"],\"name\":[1],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"is_canceled\"],\"name\":[2],\"type\":[\"lgl\"],\"align\":[\"right\"]},{\"label\":[\"lead_time\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"stays_in_weekend_nights\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"stays_in_week_nights\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"adults\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"children\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"babies\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"meal\"],\"name\":[9],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"country\"],\"name\":[10],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"market_segment\"],\"name\":[11],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"distribution_channel\"],\"name\":[12],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"is_repeated_guest\"],\"name\":[13],\"type\":[\"lgl\"],\"align\":[\"right\"]},{\"label\":[\"previous_cancellations\"],\"name\":[14],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"previous_bookings_not_canceled\"],\"name\":[15],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"reserved_room_type\"],\"name\":[16],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"assigned_room_type\"],\"name\":[17],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"booking_changes\"],\"name\":[18],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"deposit_type\"],\"name\":[19],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"agent\"],\"name\":[20],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"company\"],\"name\":[21],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"days_in_waiting_list\"],\"name\":[22],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"customer_type\"],\"name\":[23],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"adr\"],\"name\":[24],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"required_car_parking_spaces\"],\"name\":[25],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"total_of_special_requests\"],\"name\":[26],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"reservation_status\"],\"name\":[27],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"reservation_status_date\"],\"name\":[28],\"type\":[\"date\"],\"align\":[\"right\"]},{\"label\":[\"arrival_date\"],\"name\":[29],\"type\":[\"date\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"Resort Hotel\",\"2\":\"FALSE\",\"3\":\"342\",\"4\":\"0\",\"5\":\"0\",\"6\":\"2\",\"7\":\"0\",\"8\":\"0\",\"9\":\"BB\",\"10\":\"PRT\",\"11\":\"Direct\",\"12\":\"Direct\",\"13\":\"FALSE\",\"14\":\"0\",\"15\":\"0\",\"16\":\"C\",\"17\":\"C\",\"18\":\"3\",\"19\":\"No Deposit\",\"20\":\"NULL\",\"21\":\"NULL\",\"22\":\"0\",\"23\":\"Transient\",\"24\":\"0\",\"25\":\"0\",\"26\":\"0\",\"27\":\"Check-Out\",\"28\":\"2015-07-01\",\"29\":\"2015-07-01\"},{\"1\":\"Resort Hotel\",\"2\":\"FALSE\",\"3\":\"737\",\"4\":\"0\",\"5\":\"0\",\"6\":\"2\",\"7\":\"0\",\"8\":\"0\",\"9\":\"BB\",\"10\":\"PRT\",\"11\":\"Direct\",\"12\":\"Direct\",\"13\":\"FALSE\",\"14\":\"0\",\"15\":\"0\",\"16\":\"C\",\"17\":\"C\",\"18\":\"4\",\"19\":\"No Deposit\",\"20\":\"NULL\",\"21\":\"NULL\",\"22\":\"0\",\"23\":\"Transient\",\"24\":\"0\",\"25\":\"0\",\"26\":\"0\",\"27\":\"Check-Out\",\"28\":\"2015-07-01\",\"29\":\"2015-07-01\"},{\"1\":\"Resort Hotel\",\"2\":\"FALSE\",\"3\":\"7\",\"4\":\"0\",\"5\":\"1\",\"6\":\"1\",\"7\":\"0\",\"8\":\"0\",\"9\":\"BB\",\"10\":\"GBR\",\"11\":\"Direct\",\"12\":\"Direct\",\"13\":\"FALSE\",\"14\":\"0\",\"15\":\"0\",\"16\":\"A\",\"17\":\"C\",\"18\":\"0\",\"19\":\"No Deposit\",\"20\":\"NULL\",\"21\":\"NULL\",\"22\":\"0\",\"23\":\"Transient\",\"24\":\"75\",\"25\":\"0\",\"26\":\"0\",\"27\":\"Check-Out\",\"28\":\"2015-07-02\",\"29\":\"2015-07-01\"},{\"1\":\"Resort Hotel\",\"2\":\"FALSE\",\"3\":\"13\",\"4\":\"0\",\"5\":\"1\",\"6\":\"1\",\"7\":\"0\",\"8\":\"0\",\"9\":\"BB\",\"10\":\"GBR\",\"11\":\"Corporate\",\"12\":\"Corporate\",\"13\":\"FALSE\",\"14\":\"0\",\"15\":\"0\",\"16\":\"A\",\"17\":\"A\",\"18\":\"0\",\"19\":\"No Deposit\",\"20\":\"304\",\"21\":\"NULL\",\"22\":\"0\",\"23\":\"Transient\",\"24\":\"75\",\"25\":\"0\",\"26\":\"0\",\"27\":\"Check-Out\",\"28\":\"2015-07-02\",\"29\":\"2015-07-01\"},{\"1\":\"Resort Hotel\",\"2\":\"FALSE\",\"3\":\"14\",\"4\":\"0\",\"5\":\"2\",\"6\":\"2\",\"7\":\"0\",\"8\":\"0\",\"9\":\"BB\",\"10\":\"GBR\",\"11\":\"Online TA\",\"12\":\"TA/TO\",\"13\":\"FALSE\",\"14\":\"0\",\"15\":\"0\",\"16\":\"A\",\"17\":\"A\",\"18\":\"0\",\"19\":\"No Deposit\",\"20\":\"240\",\"21\":\"NULL\",\"22\":\"0\",\"23\":\"Transient\",\"24\":\"98\",\"25\":\"0\",\"26\":\"1\",\"27\":\"Check-Out\",\"28\":\"2015-07-03\",\"29\":\"2015-07-01\"},{\"1\":\"Resort Hotel\",\"2\":\"FALSE\",\"3\":\"14\",\"4\":\"0\",\"5\":\"2\",\"6\":\"2\",\"7\":\"0\",\"8\":\"0\",\"9\":\"BB\",\"10\":\"GBR\",\"11\":\"Online TA\",\"12\":\"TA/TO\",\"13\":\"FALSE\",\"14\":\"0\",\"15\":\"0\",\"16\":\"A\",\"17\":\"A\",\"18\":\"0\",\"19\":\"No Deposit\",\"20\":\"240\",\"21\":\"NULL\",\"22\":\"0\",\"23\":\"Transient\",\"24\":\"98\",\"25\":\"0\",\"26\":\"1\",\"27\":\"Check-Out\",\"28\":\"2015-07-03\",\"29\":\"2015-07-01\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\nIn this code snippet, I first merge three separate date columns (year, month, day) into a new 'arrival_date' column using `paste()` and `as.Date()`. I then remove the original date columns as they're no longer needed.\n\nNext, I convert two integer columns, 'is_canceled' and 'is_repeated_guest', to logical (boolean) values for easier interpretation and manipulation, using `case_when()`.\n\nI then print unique values of some categorical variables to check for any inconsistencies, and convert these categorical variables into factors for further analysis and visualization using `mutate_at()` and `vars()`.\n\nFinally, I print the first few rows of the dataset to confirm all transformations were applied correctly.\n\n\n## Time Dependent Visualization\n\n `arrival_date`\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a new dataframe that counts the number of bookings per date for each hotel\ndata_count <- data %>%\n  group_by(arrival_date, hotel) %>%\n  summarise(bookings = n(), .groups = \"drop\") # prevent warning message\n\n# Create a smoothed time series plot of hotel bookings\nggplot(data_count, aes(x = arrival_date, y = bookings, color = hotel)) +\n  geom_smooth(se = FALSE, size = 1) +  # se = FALSE removes the confidence interval around the line\n  scale_x_date(labels = date_format(\"%Y-%m\"), breaks = \"1 months\") +\n  scale_y_continuous(labels = scales::comma) +\n  labs(x = \"Arrival Date\", y = \"Number of Bookings\",\n       color = \"Hotel Type\",\n       title = \"Time Series of Hotel Bookings\") +\n  theme_minimal() +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1))\n```\n\n::: {.cell-output-display}\n![](ZhongyueLin_challenge_6_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\nIn this code, I created a new dataframe `data_count` which counts the number of bookings each day for each hotel.\n\nAfterward, I generated a plot using the `ggplot()` function. In this plot, the x-axis is the arrival date, the y-axis is the number of bookings, and the color differentiates between different hotels. I utilized the `geom_smooth()` function to draw a smoothed line to better show the trend over time.\n\nNext, I adjusted the format of the x-axis and y-axis labels to make them more understandable using `scale_x_date()` and `scale_y_continuous()`. Also, I added the title and labels for the plot with the `labs()` function.\n\nFinally, I adjusted the theme and style of the plot using `theme_minimal()` and `theme()` functions. I chose a minimalist theme and tilted the x-axis labels by 45 degrees for a clearer date display.\n\nThe resulting plot displays the trends of hotel bookings over time, which will help me understand the booking behaviors of customers and the operational status of the hotels.\n\n `cancellation_rate` \n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a new dataframe that calculates the cancellation rate per date for each hotel\ndata_cancel_rate <- data %>%\n  group_by(arrival_date, hotel) %>%\n  summarise(cancel_rate = mean(is_canceled), .groups = \"drop\") # prevent warning message\n\n# Create a smoothed time series plot of cancellation rate\nggplot(data_cancel_rate, aes(x = arrival_date, y = cancel_rate, color = hotel)) +\n  geom_smooth(se = FALSE, size = 1) +  # se = FALSE removes the confidence interval around the line\n  scale_x_date(labels = date_format(\"%Y-%m\"), breaks = \"1 months\") +\n  scale_y_continuous(labels = scales::percent) +\n  labs(x = \"Arrival Date\", y = \"Cancellation Rate\",\n       color = \"Hotel Type\",\n       title = \"Time Series of Hotel Cancellation Rates\") +\n  theme_minimal() +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1))\n```\n\n::: {.cell-output-display}\n![](ZhongyueLin_challenge_6_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n \n\n## Visualizing Part-Whole Relationships\n`room types`\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a dataframe that counts the number of each room type\nroom_count <- data %>%\n  group_by(assigned_room_type) %>%\n  summarise(count = n(), .groups = \"drop\")\n\n# Create a pie chart of assigned room types\nggplot(room_count, aes(x = \"\", y = count, fill = assigned_room_type)) +\n  geom_bar(width = 1, stat = \"identity\") +\n  coord_polar(\"y\", start = 0) +\n  theme_void() +\n  labs(fill = \"Assigned Room Type\",\n       title = \"Distribution of Assigned Room Types\",\n       x = NULL, y = NULL)\n```\n\n::: {.cell-output-display}\n![](ZhongyueLin_challenge_6_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\nIn this code, I first create a new dataframe room_count which counts the number of each assigned room type.\n\nAfterward, I generate a pie chart using the `ggplot()` function, where the fill aesthetic is mapped to the room type and the size of each slice (y-axis) is determined by the count of each room type. I use `geom_bar()` with stat = \"identity\" to create the pie chart and `coord_polar()` to convert the bar chart to a pie chart.\n\nFinally, I remove the axes and grid lines with `theme_void()` for a cleaner look and add labels and a title with `labs()`. The resulting plot displays the distribution of assigned room types, which will help me understand the occupancy situation of different room types.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# First, we need to extract the year and month from the 'arrival_date' column\ndata <- data %>%\n  mutate(year_month = paste(format(arrival_date, \"%Y-%m\"), \"-01\", sep = \"\"))\n\n# Create a new dataframe that counts the number of cancellations per month for each hotel\ndata_cancel <- data %>%\n  filter(is_canceled == TRUE) %>%\n  group_by(year_month, hotel) %>%\n  summarise(cancelations = n(), .groups = \"drop\")\n\n# Create a stacked bar chart of cancellations\nggplot(data_cancel, aes(x = as.Date(year_month), y = cancelations, fill = hotel)) +\n  geom_bar(stat = \"identity\", position = \"stack\") +\n  scale_x_date(date_labels = \"%Y-%m\", date_breaks = \"1 month\") +\n  scale_y_continuous(labels = scales::comma) +\n  labs(x = \"Year-Month\", y = \"Number of Cancellations\",\n       fill = \"Hotel Type\",\n       title = \"Cancellations by Hotel Type Over Time\") +\n  theme_minimal() +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1))\n```\n\n::: {.cell-output-display}\n![](ZhongyueLin_challenge_6_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\nIn this code, I first prepared a dataframe to represent the count of monthly booking cancellations for each hotel. This was achieved by filtering rows where `is_canceled` was `TRUE`, transforming the `arrival_date` into a Year-Month format using `mutate()` and `format()`, and subsequently grouping and summarising the data to provide the number of cancellations per month for each hotel.\n\nFollowing data preparation, I used the `ggplot()` function to create a stacked bar chart that depicted the number of booking cancellations over time, with color coding to differentiate between hotel types. The aesthetic mapping (`aes()`) was defined with `arrival_month` on the x-axis, `cancelations` on the y-axis, and `hotel` defining the fill color. The bars were created using the `geom_bar()` function with `stat = \"identity\"`, allowing for the actual cancellation values to be plotted on the y-axis, and `position = \"stack\"` facilitating a stacked representation of cancellation counts for the different hotels.\n\nTo ensure readability, I controlled the x-axis ticks using `scale_x_discrete()`, setting a label every three months to avoid clutter. Similarly, the y-axis tick labels were made more readable by using `scales::comma` within the `scale_y_continuous()` function.\n\nThe chart's title and labels for the x-axis, y-axis, and fill color were defined using `labs()`. Lastly, I utilized `theme_minimal()` for a clean look and adjusted the x-axis labels' angle to 45 degrees using `element_text(angle = 45, hjust = 1)` within the `theme()` function, preventing any label overlap.\n",
    "supporting": [
      "ZhongyueLin_challenge_6_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}