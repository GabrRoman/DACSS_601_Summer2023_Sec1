{
  "hash": "4014df4533ebaeaa6137afbb5da73a37",
  "result": {
    "markdown": "---\ntitle: \"Challenge 4 Solution - Debt Dataset\"\nauthor: \"Linus Jen\"\ndescription: \"More data wrangling: pivoting\"\ndate: \"6/9/2023\"\nformat:\n  html:\n    toc: true\n    code-fold: true\n    code-copy: true\n    code-tools: true\n    df-print: paged\ncategories:\n  - challenge_4\n  - debt\n  - Linus Jen\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(here)\n\nknitr::opts_chunk$set(echo = TRUE, warning=FALSE, message=FALSE)\n```\n:::\n\n\n## Read in data\n\nFor this challenge, I will be working with the `debt_in_trillions.xlsx` dataset.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata <- readxl::read_excel(here(\"posts\", \"_data\", \"debt_in_trillions.xlsx\"))\n\n# Display data\nprint(paste0(\"There are \", dim(data)[1], \" rows and \", dim(data)[2], \" columns in this dataset.\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"There are 74 rows and 8 columns in this dataset.\"\n```\n:::\n\n```{.r .cell-code}\nhead(data)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"Year and Quarter\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Mortgage\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"HE Revolving\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Auto Loan\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Credit Card\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Student Loan\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Other\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Total\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"03:Q1\",\"2\":\"4.942\",\"3\":\"0.242\",\"4\":\"0.641\",\"5\":\"0.688\",\"6\":\"0.2407\",\"7\":\"0.4776\",\"8\":\"7.2313\"},{\"1\":\"03:Q2\",\"2\":\"5.080\",\"3\":\"0.260\",\"4\":\"0.622\",\"5\":\"0.693\",\"6\":\"0.2429\",\"7\":\"0.4860\",\"8\":\"7.3839\"},{\"1\":\"03:Q3\",\"2\":\"5.183\",\"3\":\"0.269\",\"4\":\"0.684\",\"5\":\"0.693\",\"6\":\"0.2488\",\"7\":\"0.4773\",\"8\":\"7.5551\"},{\"1\":\"03:Q4\",\"2\":\"5.660\",\"3\":\"0.302\",\"4\":\"0.704\",\"5\":\"0.698\",\"6\":\"0.2529\",\"7\":\"0.4486\",\"8\":\"8.0655\"},{\"1\":\"04:Q1\",\"2\":\"5.840\",\"3\":\"0.328\",\"4\":\"0.720\",\"5\":\"0.695\",\"6\":\"0.2598\",\"7\":\"0.4465\",\"8\":\"8.2893\"},{\"1\":\"04:Q2\",\"2\":\"5.967\",\"3\":\"0.367\",\"4\":\"0.743\",\"5\":\"0.697\",\"6\":\"0.2629\",\"7\":\"0.4231\",\"8\":\"8.4600\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\nglimpse(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 74\nColumns: 8\n$ `Year and Quarter` <chr> \"03:Q1\", \"03:Q2\", \"03:Q3\", \"03:Q4\", \"04:Q1\", \"04:Q2…\n$ Mortgage           <dbl> 4.942, 5.080, 5.183, 5.660, 5.840, 5.967, 6.210, 6.…\n$ `HE Revolving`     <dbl> 0.242, 0.260, 0.269, 0.302, 0.328, 0.367, 0.426, 0.…\n$ `Auto Loan`        <dbl> 0.641, 0.622, 0.684, 0.704, 0.720, 0.743, 0.751, 0.…\n$ `Credit Card`      <dbl> 0.688, 0.693, 0.693, 0.698, 0.695, 0.697, 0.706, 0.…\n$ `Student Loan`     <dbl> 0.2407000, 0.2429000, 0.2488000, 0.2529000, 0.25980…\n$ Other              <dbl> 0.4776, 0.4860, 0.4773, 0.4486, 0.4465, 0.4231, 0.4…\n$ Total              <dbl> 7.2313, 7.3839, 7.5551, 8.0655, 8.2893, 8.4600, 8.8…\n```\n:::\n\n```{.r .cell-code}\n# Check NAs\ndata %>%\n  summarise(across(everything(), ~sum(is.na(.))))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"Year and Quarter\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"Mortgage\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"HE Revolving\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"Auto Loan\"],\"name\":[4],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"Credit Card\"],\"name\":[5],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"Student Loan\"],\"name\":[6],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"Other\"],\"name\":[7],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"Total\"],\"name\":[8],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"0\",\"2\":\"0\",\"3\":\"0\",\"4\":\"0\",\"5\":\"0\",\"6\":\"0\",\"7\":\"0\",\"8\":\"0\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n### Briefly describe the data\n\nBased on the title of the `.csv` file and what is shown within the document (I opened the Excel file to see what the data looked like before importing it), this file shows debt for various sectors, in trillions of dollars. I found information about this dataset from [this site](https://www.newyorkfed.org/medialibrary/interactives/householdcredit/data/pdf/HHDC_2019Q4.pdf). Per this report's data dictionary, data includes the year and quarter, the mortgage debt, home equity revolving debt, auto loan debt, credit card debt, student loan debt, other debt, and the total debt, all in trillions of dollars. This was collected by the FRBNY Consumer Credit Panel, and comes from a 5% random sample of all individuals with a social security number and credit report.\n\nFrom the `Year and Quarter` column, we see that we get a 2 digit year and a quarter, separated by a `:`. All other columns are floats, and should be dollar amounts in the trillions.\n\n## Tidy Data (as needed)\n\nThis data is clearly not tidy. All the numerical columns contain one type (debt in (\\$)), while the column headers represent a category of debt. Thus, we need to `pivot_longer()` this data so that we get a column for the types of debt. Additionally, need to convert the `Year and Quarter` column to be a `lubridate` quarter value \n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata <- data %>%\n  # First year and quarter first\n  mutate(`year_quarter` = quarter(yq(`Year and Quarter`), with_year=TRUE)) %>%\n  # make tidy by pivot_longer()\n  pivot_longer(!c(`Year and Quarter`, year_quarter), names_to=\"debt_type\", values_to=\"debt_amount\") %>%\n  mutate(debt_type = factor(debt_type, levels=unique(debt_type))) %>%\n  select(-`Year and Quarter`)\n```\n:::\n\n\n## Results\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# View data\nhead(data)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"year_quarter\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"debt_type\"],\"name\":[2],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"debt_amount\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"2003.1\",\"2\":\"Mortgage\",\"3\":\"4.9420\"},{\"1\":\"2003.1\",\"2\":\"HE Revolving\",\"3\":\"0.2420\"},{\"1\":\"2003.1\",\"2\":\"Auto Loan\",\"3\":\"0.6410\"},{\"1\":\"2003.1\",\"2\":\"Credit Card\",\"3\":\"0.6880\"},{\"1\":\"2003.1\",\"2\":\"Student Loan\",\"3\":\"0.2407\"},{\"1\":\"2003.1\",\"2\":\"Other\",\"3\":\"0.4776\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\nglimpse(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 518\nColumns: 3\n$ year_quarter <dbl> 2003.1, 2003.1, 2003.1, 2003.1, 2003.1, 2003.1, 2003.1, 2…\n$ debt_type    <fct> Mortgage, HE Revolving, Auto Loan, Credit Card, Student L…\n$ debt_amount  <dbl> 4.9420, 0.2420, 0.6410, 0.6880, 0.2407, 0.4776, 7.2313, 5…\n```\n:::\n\n```{.r .cell-code}\nhead(data$debt_type)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] Mortgage     HE Revolving Auto Loan    Credit Card  Student Loan\n[6] Other       \n7 Levels: Mortgage HE Revolving Auto Loan Credit Card Student Loan ... Total\n```\n:::\n:::\n\n\nFrom the output above, we now see our data in a tidy format. Firstly, our `year_quarter` column is the correct date type, using `lubridate` to convert the `YY:Q#` format to `YYYY.Q` format. The `debt_type` column contains the category of household debt - note that we kept the `total` column in case someone wanted to compare totals (though this category can be seen as redundant). We also converted the column to be a set of factors, and ordered it based on the order of the columns presented in the dataset (and specifically keeping the \"Other\" and \"Total\" categories together). Lastly, we have the `debt_amount` column that contains the debt (in trillions of US dollars).\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}